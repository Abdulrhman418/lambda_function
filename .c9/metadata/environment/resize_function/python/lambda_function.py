{"changed":true,"filter":false,"title":"lambda_function.py","tooltip":"/resize_function/python/lambda_function.py","value":"import boto3\nimport json\nimport os\nfrom PIL import Image\nimport io\nimport urllib.parse  \n\ns3 = boto3.client('s3')\n\ndef lambda_handler(event, context):\n    bucket = event['Records'][0]['s3']['bucket']['name']\n    key    = urllib.parse.unquote(event['Records'][0]['s3']['object']['key'])  \n\n    image_obj = s3.get_object(Bucket=bucket, Key=key)\n    image_content = image_obj['Body'].read()\n\n \n    image = Image.open(io.BytesIO(image_content))\n\n \n    resized_image = image.resize((200, 200))\n\n\n    buffer = io.BytesIO()\n\n    image_format = image.format if image.format else 'JPEG'\n\n    resized_image.save(buffer, format=image_format)\n    buffer.seek(0)\n\n\n    filename = key.split('/')[-1]\n    resized_key = 'resized/' + filename\n    \n    des_bucket = 'vuyhrfv'\n    s3.put_object(\n        Bucket=des_bucket, \n        Key=resized_key,\n        Body=buffer,\n        ContentType=image_obj['ContentType']\n    )\n\n    return {\n        'statusCode': 200,\n        'body': json.dumps(f'Resized image uploaded to resized/{filename}')\n    }\n","undoManager":{"mark":0,"position":61,"stack":[[{"start":{"row":0,"column":0},"end":{"row":47,"column":0},"action":"insert","lines":["import boto3","import json","import os","from PIL import Image","import io","import urllib.parse  ","","s3 = boto3.client('s3')","","def lambda_handler(event, context):","    bucket = event['Records'][0]['s3']['bucket']['name']","    key    = urllib.parse.unquote(event['Records'][0]['s3']['object']['key'])","","    image_obj = s3.get_object(Bucket=bucket, Key=key)","    image_content = image_obj['Body'].read()","","    # فتح الصورة باستخدام PIL","    image = Image.open(io.BytesIO(image_content))","","    # Resize","    resized_image = image.resize((200, 200))","","    # حفظ الصورة في buffer","    buffer = io.BytesIO()","","    # استخدم JPEG كافتراضي لو النوع غير معروف","    image_format = image.format if image.format else 'JPEG'","","    resized_image.save(buffer, format=image_format)","    buffer.seek(0)","","    # تحديد اسم الصورة المصغرة","    filename = key.split('/')[-1]","    resized_key = 'resized/' + filename","","    # رفع الصورة المصغرة إلى bucket آخر أو نفس البكت","    s3.put_object(","        Bucket='vuyhrfv',","        Key=resized_key,","        Body=buffer,","        ContentType=image_obj['ContentType']","    )","","    return {","        'statusCode': 200,","        'body': json.dumps(f'Resized image uploaded to resized/{filename}')","    }",""],"id":1}],[{"start":{"row":16,"column":1},"end":{"row":16,"column":29},"action":"remove","lines":["   # فتح الصورة باستخدام PIL"],"id":2}],[{"start":{"row":11,"column":77},"end":{"row":11,"column":78},"action":"insert","lines":[" "],"id":3},{"start":{"row":11,"column":78},"end":{"row":11,"column":79},"action":"insert","lines":["f"]},{"start":{"row":11,"column":79},"end":{"row":11,"column":80},"action":"insert","lines":["o"]},{"start":{"row":11,"column":80},"end":{"row":11,"column":81},"action":"insert","lines":["r"]}],[{"start":{"row":11,"column":81},"end":{"row":11,"column":82},"action":"insert","lines":[" "],"id":4}],[{"start":{"row":11,"column":81},"end":{"row":11,"column":82},"action":"remove","lines":[" "],"id":5},{"start":{"row":11,"column":80},"end":{"row":11,"column":81},"action":"remove","lines":["r"]},{"start":{"row":11,"column":79},"end":{"row":11,"column":80},"action":"remove","lines":["o"]},{"start":{"row":11,"column":78},"end":{"row":11,"column":79},"action":"remove","lines":["f"]}],[{"start":{"row":11,"column":78},"end":{"row":11,"column":79},"action":"insert","lines":["#"],"id":6}],[{"start":{"row":11,"column":79},"end":{"row":11,"column":80},"action":"insert","lines":[" "],"id":7},{"start":{"row":11,"column":80},"end":{"row":11,"column":81},"action":"insert","lines":["f"]},{"start":{"row":11,"column":81},"end":{"row":11,"column":82},"action":"insert","lines":["o"]},{"start":{"row":11,"column":82},"end":{"row":11,"column":83},"action":"insert","lines":["r"]}],[{"start":{"row":11,"column":83},"end":{"row":11,"column":84},"action":"insert","lines":[" "],"id":8}],[{"start":{"row":11,"column":84},"end":{"row":11,"column":85},"action":"insert","lines":["d"],"id":9},{"start":{"row":11,"column":85},"end":{"row":11,"column":86},"action":"insert","lines":["e"]},{"start":{"row":11,"column":86},"end":{"row":11,"column":87},"action":"insert","lines":["a"]},{"start":{"row":11,"column":87},"end":{"row":11,"column":88},"action":"insert","lines":["l"]}],[{"start":{"row":11,"column":88},"end":{"row":11,"column":89},"action":"insert","lines":[" "],"id":10},{"start":{"row":11,"column":89},"end":{"row":11,"column":90},"action":"insert","lines":["w"]},{"start":{"row":11,"column":90},"end":{"row":11,"column":91},"action":"insert","lines":["i"]},{"start":{"row":11,"column":91},"end":{"row":11,"column":92},"action":"insert","lines":["t"]},{"start":{"row":11,"column":92},"end":{"row":11,"column":93},"action":"insert","lines":["h"]}],[{"start":{"row":11,"column":93},"end":{"row":11,"column":94},"action":"insert","lines":[" "],"id":11}],[{"start":{"row":11,"column":94},"end":{"row":11,"column":95},"action":"insert","lines":["s"],"id":12},{"start":{"row":11,"column":95},"end":{"row":11,"column":96},"action":"insert","lines":["p"]},{"start":{"row":11,"column":96},"end":{"row":11,"column":97},"action":"insert","lines":["a"]}],[{"start":{"row":11,"column":96},"end":{"row":11,"column":97},"action":"remove","lines":["a"],"id":13},{"start":{"row":11,"column":95},"end":{"row":11,"column":96},"action":"remove","lines":["p"]},{"start":{"row":11,"column":94},"end":{"row":11,"column":95},"action":"remove","lines":["s"]}],[{"start":{"row":11,"column":94},"end":{"row":11,"column":95},"action":"insert","lines":["u"],"id":14},{"start":{"row":11,"column":95},"end":{"row":11,"column":96},"action":"insert","lines":["n"]},{"start":{"row":11,"column":96},"end":{"row":11,"column":97},"action":"insert","lines":["k"]},{"start":{"row":11,"column":97},"end":{"row":11,"column":98},"action":"insert","lines":["n"]}],[{"start":{"row":11,"column":98},"end":{"row":11,"column":99},"action":"insert","lines":["o"],"id":15},{"start":{"row":11,"column":99},"end":{"row":11,"column":100},"action":"insert","lines":["w"]},{"start":{"row":11,"column":100},"end":{"row":11,"column":101},"action":"insert","lines":["n"]}],[{"start":{"row":11,"column":101},"end":{"row":11,"column":102},"action":"insert","lines":[" "],"id":16},{"start":{"row":11,"column":102},"end":{"row":11,"column":103},"action":"insert","lines":["c"]},{"start":{"row":11,"column":103},"end":{"row":11,"column":104},"action":"insert","lines":["h"]},{"start":{"row":11,"column":104},"end":{"row":11,"column":105},"action":"insert","lines":["a"]},{"start":{"row":11,"column":105},"end":{"row":11,"column":106},"action":"insert","lines":["r"]},{"start":{"row":11,"column":106},"end":{"row":11,"column":107},"action":"insert","lines":["a"]},{"start":{"row":11,"column":107},"end":{"row":11,"column":108},"action":"insert","lines":["c"]}],[{"start":{"row":11,"column":108},"end":{"row":11,"column":109},"action":"insert","lines":["h"],"id":17},{"start":{"row":11,"column":109},"end":{"row":11,"column":110},"action":"insert","lines":["t"]},{"start":{"row":11,"column":110},"end":{"row":11,"column":111},"action":"insert","lines":["e"]},{"start":{"row":11,"column":111},"end":{"row":11,"column":112},"action":"insert","lines":["r"]}],[{"start":{"row":11,"column":112},"end":{"row":11,"column":113},"action":"insert","lines":[" "],"id":18}],[{"start":{"row":19,"column":2},"end":{"row":19,"column":12},"action":"remove","lines":["  # Resize"],"id":19},{"start":{"row":19,"column":1},"end":{"row":19,"column":2},"action":"remove","lines":[" "]}],[{"start":{"row":22,"column":0},"end":{"row":22,"column":26},"action":"remove","lines":["    # حفظ الصورة في buffer"],"id":20}],[{"start":{"row":22,"column":0},"end":{"row":22,"column":4},"action":"insert","lines":["    "],"id":21}],[{"start":{"row":22,"column":4},"end":{"row":22,"column":5},"action":"insert","lines":["s"],"id":22},{"start":{"row":22,"column":5},"end":{"row":22,"column":6},"action":"insert","lines":["a"]},{"start":{"row":22,"column":6},"end":{"row":22,"column":7},"action":"insert","lines":["v"]},{"start":{"row":22,"column":7},"end":{"row":22,"column":8},"action":"insert","lines":["e"]}],[{"start":{"row":22,"column":8},"end":{"row":22,"column":9},"action":"insert","lines":[" "],"id":23}],[{"start":{"row":22,"column":8},"end":{"row":22,"column":9},"action":"remove","lines":[" "],"id":24},{"start":{"row":22,"column":7},"end":{"row":22,"column":8},"action":"remove","lines":["e"]},{"start":{"row":22,"column":6},"end":{"row":22,"column":7},"action":"remove","lines":["v"]},{"start":{"row":22,"column":5},"end":{"row":22,"column":6},"action":"remove","lines":["a"]},{"start":{"row":22,"column":4},"end":{"row":22,"column":5},"action":"remove","lines":["s"]}],[{"start":{"row":22,"column":4},"end":{"row":22,"column":5},"action":"insert","lines":["#"],"id":25}],[{"start":{"row":22,"column":5},"end":{"row":22,"column":6},"action":"insert","lines":[" "],"id":26},{"start":{"row":22,"column":6},"end":{"row":22,"column":7},"action":"insert","lines":["s"]},{"start":{"row":22,"column":7},"end":{"row":22,"column":8},"action":"insert","lines":["a"]},{"start":{"row":22,"column":8},"end":{"row":22,"column":9},"action":"insert","lines":["v"]},{"start":{"row":22,"column":9},"end":{"row":22,"column":10},"action":"insert","lines":["e"]}],[{"start":{"row":22,"column":10},"end":{"row":22,"column":11},"action":"insert","lines":[" "],"id":27},{"start":{"row":22,"column":11},"end":{"row":22,"column":12},"action":"insert","lines":["i"]},{"start":{"row":22,"column":12},"end":{"row":22,"column":13},"action":"insert","lines":["n"]}],[{"start":{"row":22,"column":13},"end":{"row":22,"column":14},"action":"insert","lines":[" "],"id":28},{"start":{"row":22,"column":14},"end":{"row":22,"column":15},"action":"insert","lines":["b"]},{"start":{"row":22,"column":15},"end":{"row":22,"column":16},"action":"insert","lines":["u"]},{"start":{"row":22,"column":16},"end":{"row":22,"column":17},"action":"insert","lines":["f"]},{"start":{"row":22,"column":17},"end":{"row":22,"column":18},"action":"insert","lines":["f"]},{"start":{"row":22,"column":18},"end":{"row":22,"column":19},"action":"insert","lines":["e"]},{"start":{"row":22,"column":19},"end":{"row":22,"column":20},"action":"insert","lines":["r"]}],[{"start":{"row":25,"column":2},"end":{"row":25,"column":21},"action":"remove","lines":["  # استخدم JPEG كاف"],"id":29}],[{"start":{"row":25,"column":0},"end":{"row":25,"column":26},"action":"remove","lines":["  تراضي لو النوع غير معروف"],"id":30},{"start":{"row":24,"column":0},"end":{"row":25,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":24,"column":0},"end":{"row":25,"column":0},"action":"insert","lines":["",""],"id":31}],[{"start":{"row":25,"column":0},"end":{"row":25,"column":4},"action":"insert","lines":["    "],"id":32}],[{"start":{"row":25,"column":4},"end":{"row":25,"column":5},"action":"insert","lines":["a"],"id":33},{"start":{"row":25,"column":5},"end":{"row":25,"column":6},"action":"insert","lines":["g"]},{"start":{"row":25,"column":6},"end":{"row":25,"column":7},"action":"insert","lines":["g"]},{"start":{"row":25,"column":7},"end":{"row":25,"column":8},"action":"insert","lines":["i"]},{"start":{"row":25,"column":8},"end":{"row":25,"column":9},"action":"insert","lines":["n"]}],[{"start":{"row":25,"column":8},"end":{"row":25,"column":9},"action":"remove","lines":["n"],"id":34},{"start":{"row":25,"column":7},"end":{"row":25,"column":8},"action":"remove","lines":["i"]},{"start":{"row":25,"column":6},"end":{"row":25,"column":7},"action":"remove","lines":["g"]},{"start":{"row":25,"column":5},"end":{"row":25,"column":6},"action":"remove","lines":["g"]},{"start":{"row":25,"column":4},"end":{"row":25,"column":5},"action":"remove","lines":["a"]},{"start":{"row":25,"column":0},"end":{"row":25,"column":4},"action":"remove","lines":["    "]},{"start":{"row":24,"column":0},"end":{"row":25,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":22,"column":0},"end":{"row":22,"column":20},"action":"remove","lines":["    # save in buffer"],"id":35}],[{"start":{"row":11,"column":78},"end":{"row":11,"column":112},"action":"remove","lines":["# for deal with unknown charachter"],"id":36}],[{"start":{"row":30,"column":4},"end":{"row":30,"column":6},"action":"remove","lines":["# "],"id":37},{"start":{"row":30,"column":0},"end":{"row":30,"column":4},"action":"remove","lines":["    "]},{"start":{"row":29,"column":0},"end":{"row":30,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":29,"column":0},"end":{"row":30,"column":0},"action":"insert","lines":["",""],"id":38}],[{"start":{"row":29,"column":0},"end":{"row":30,"column":24},"action":"remove","lines":["","تحديد اسم الصورة المصغرة"],"id":39}],[{"start":{"row":29,"column":0},"end":{"row":30,"column":0},"action":"insert","lines":["",""],"id":40}],[{"start":{"row":34,"column":0},"end":{"row":34,"column":36},"action":"remove","lines":["    # رفع الصورة المصغرة إلى bucket "],"id":41}],[{"start":{"row":33,"column":0},"end":{"row":34,"column":16},"action":"remove","lines":["","آخر أو نفس البكت"],"id":42}],[{"start":{"row":33,"column":0},"end":{"row":34,"column":0},"action":"insert","lines":["",""],"id":43}],[{"start":{"row":36,"column":25},"end":{"row":36,"column":26},"action":"insert","lines":[" "],"id":44}],[{"start":{"row":33,"column":0},"end":{"row":33,"column":4},"action":"insert","lines":["    "],"id":45}],[{"start":{"row":33,"column":4},"end":{"row":34,"column":0},"action":"insert","lines":["",""],"id":46},{"start":{"row":34,"column":0},"end":{"row":34,"column":4},"action":"insert","lines":["    "]},{"start":{"row":34,"column":4},"end":{"row":34,"column":5},"action":"insert","lines":["d"]},{"start":{"row":34,"column":5},"end":{"row":34,"column":6},"action":"insert","lines":["e"]},{"start":{"row":34,"column":6},"end":{"row":34,"column":7},"action":"insert","lines":["s"]}],[{"start":{"row":34,"column":7},"end":{"row":34,"column":8},"action":"insert","lines":["_"],"id":47},{"start":{"row":34,"column":8},"end":{"row":34,"column":9},"action":"insert","lines":["b"]},{"start":{"row":34,"column":9},"end":{"row":34,"column":10},"action":"insert","lines":["u"]},{"start":{"row":34,"column":10},"end":{"row":34,"column":11},"action":"insert","lines":["c"]},{"start":{"row":34,"column":11},"end":{"row":34,"column":12},"action":"insert","lines":["k"]}],[{"start":{"row":34,"column":12},"end":{"row":34,"column":13},"action":"insert","lines":["e"],"id":48},{"start":{"row":34,"column":13},"end":{"row":34,"column":14},"action":"insert","lines":["t"]}],[{"start":{"row":34,"column":14},"end":{"row":34,"column":15},"action":"insert","lines":[" "],"id":49},{"start":{"row":34,"column":15},"end":{"row":34,"column":16},"action":"insert","lines":["="]}],[{"start":{"row":34,"column":16},"end":{"row":34,"column":17},"action":"insert","lines":[" "],"id":50}],[{"start":{"row":34,"column":17},"end":{"row":34,"column":19},"action":"insert","lines":["\"\""],"id":51}],[{"start":{"row":34,"column":17},"end":{"row":34,"column":19},"action":"remove","lines":["\"\""],"id":52}],[{"start":{"row":34,"column":17},"end":{"row":34,"column":19},"action":"insert","lines":["''"],"id":53}],[{"start":{"row":34,"column":18},"end":{"row":34,"column":27},"action":"insert","lines":["'vuyhrfv'"],"id":54}],[{"start":{"row":34,"column":26},"end":{"row":34,"column":28},"action":"remove","lines":["''"],"id":55}],[{"start":{"row":34,"column":26},"end":{"row":35,"column":0},"action":"remove","lines":["",""],"id":56}],[{"start":{"row":34,"column":26},"end":{"row":34,"column":27},"action":"insert","lines":["'"],"id":57}],[{"start":{"row":34,"column":17},"end":{"row":34,"column":19},"action":"remove","lines":["''"],"id":58}],[{"start":{"row":34,"column":17},"end":{"row":34,"column":18},"action":"insert","lines":["'"],"id":59}],[{"start":{"row":36,"column":16},"end":{"row":36,"column":24},"action":"remove","lines":["vuyhrfv'"],"id":60},{"start":{"row":36,"column":15},"end":{"row":36,"column":16},"action":"remove","lines":["'"]}],[{"start":{"row":36,"column":15},"end":{"row":36,"column":16},"action":"insert","lines":["d"],"id":61},{"start":{"row":36,"column":16},"end":{"row":36,"column":17},"action":"insert","lines":["e"]},{"start":{"row":36,"column":17},"end":{"row":36,"column":18},"action":"insert","lines":["s"]}],[{"start":{"row":36,"column":15},"end":{"row":36,"column":18},"action":"remove","lines":["des"],"id":62},{"start":{"row":36,"column":15},"end":{"row":36,"column":25},"action":"insert","lines":["des_bucket"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":4,"column":9},"end":{"row":4,"column":9},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1754608522699}